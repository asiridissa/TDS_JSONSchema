{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "title": "TDS TRCPSchema v0.4",
  "description": "Based on XML Schema tcrp.demandtrans.com_TCRPSchema V0.8-proposed",
  "type": "object",
  "additionalProperties": false,
  "properties": {

    "tripStatusChange": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "status": {
          "type": "string",
          "enum": [ "Cancel", "Expire" ]
        },
        "reasonDescription": { "$ref": "#/$defs/stringNullable" },
        "canceledBy": {
          "type": "string",
          "enum": [ "OrderingClient", "Rider", "Provider" ]
        }
      },
      "required": [ "tripTicketId", "status", "canceledBy" ]
    },

    "tripRequest": {
      "type": "object",
      "description": "Telegram #: 1A; From: ordering client; To: trip provider(s); Purpose: query for trip availability",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "pickupAddress": { "$ref": "#/$defs/AddressType" },
        "detailedPickupLocationDescription": { "$ref": "#/$defs/stringNullable" },
        "dropoffAddress": { "$ref": "#/$defs/AddressType" },
        "detailedDropoffLocationDescription": { "$ref": "#/$defs/stringNullable" },
        "pickupTime": { "$ref": "#/$defs/Time" },
        "appointmentTime": { "$ref": "#/$defs/Time" },
        "dropoffTime": { "$ref": "#/$defs/Time" },
        "pickupWindowStartTime": { "$ref": "#/$defs/Time" },
        "pickupWindowEndTime": { "$ref": "#/$defs/Time" },
        "detoursPermissible": { "$ref": "#/$defs/booleanNullable" },
        "negotiatedPickupTime": { "$ref": "#/$defs/Time" },
        "hardConstraintOnPickupTime": { "$ref": "#/$defs/booleanNullable" },
        "hardConstraintOnDropoffTime": { "$ref": "#/$defs/booleanNullable" },
        "customerInfo": { "$ref": "#/$defs/CustomerInfoType" },
        "specialAttributes": { "$ref": "#/$defs/SpecialAttributesList" },
        "transportServices": { "$ref": "#/$defs/ValueList" },
        "numOtherReservedPassengers": { "$ref": "#/$defs/integerNullable" },
        "openAttribute": {
          "allOf": [
            { "$ref": "#/$defs/stringNullable" },
            { "description": "Open attribute for local use" }
          ]
        },
        "tripPurpose": { "$ref": "#/$defs/TripPurposeList" },
        "tripTransfer": { "$ref": "#/$defs/booleanNullable" },
        "notesForDriver": { "$ref": "#/$defs/stringNullable" }
      },
      "required": [ "tripTicketId" ]
    },

    "tripRequestResponse": {
      "type": "object",
      "description": "Telegram #: 1B; From: trip provider; To: ordering client;  Purpose: reply to telegram 1A for accepting the trip or denying the trip (tripAvailable)",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "tripAvailable": { "type": "boolean" },
        "scheduledPickupTime": { "$ref": "#/$defs/Time" },
        "scheduledPickupPoint": { "$ref": "#/$defs/AddressType" },
        "scheduledDropoffPoint": { "$ref": "#/$defs/AddressType" },
        "transferPoint": { "$ref": "#/$defs/AddressType" },
        "PaymentTypeList": { "$ref": "#/$defs/PaymentTypeList" },
        "fareAmount": { "$ref": "#/$defs/integerNullable" },
        "transportServices": {
          "$ref": "#/$defs/ValueList"
        }
      },
      "required": [ "tripTicketId", "tripAvailable" ]
    },

    "clientOrderConfirmation": {
      "type": "object",
      "description": "Telegram #: 2A; From: ordering client; To: trip provider(s); Purpose: order confirmation",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "tripConfirmed": { "type": "boolean" }
      },
      "required": [ "tripTicketId", "tripConfirmed" ]
    },

    "customerInfo": {
      "$ref": "#/$defs/CustomerInfoType"
    },

    "providerOrderConfirmation": {
      "type": "object",
      "description": "Telegram #: 2B; From: trip provider; To: ordering client; Purpose: confirm trip is scheduled",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "scheduledPickupTime": { "$ref": "#/$defs/Time" },
        "scheduledPickupPoint": { "$ref": "#/$defs/AddressType" },
        "scheduledDropoffPoint": { "$ref": "#/$defs/AddressType" },
        "transferPoint": { "$ref": "#/$defs/AddressType" },
        "paymentType": { "$ref": "#/$defs/PaymentTypeList" },
        "fareAmount": { "$ref": "#/$defs/integerNullable" },
        "transportServices": { "$ref": "#/$defs/ValueList" },
        "vehicleNumber": { "$ref": "#/$defs/stringNullable" },
        "driverId": { "$ref": "#/$defs/stringNullable" },
        "driverName": { "$ref": "#/$defs/stringNullable" },
        "vehicleInformation": { "$ref": "#/$defs/stringNullable" },
        "availabilityForService": { "$ref": "#/$defs/Time" },
        "fuelRange": { "$ref": "#/$defs/integerNullable" },
        "ambulatorySpacePoints": { "$ref": "#/$defs/integerNullable" },
        "largeWheelchairSpacePoints": { "$ref": "#/$defs/integerNullable" },
        "hasRamp": { "$ref": "#/$defs/booleanNullable" },
        "hasLift": { "$ref": "#/$defs/booleanNullable" },
        "standardWheelchairSpacePoints": { "$ref": "#/$defs/integerNullable" },
        "cargoSpacePoints": { "$ref": "#/$defs/integerNullable" },
        "vehicleVIN": { "$ref": "#/$defs/integerNullable" },
        "vehicleModel": { "$ref": "#/$defs/stringNullable" },
        "conversionFactorForAmbulatoryPointsToStandardWheelchairPoints": { "$ref": "#/$defs/integerNullable" },
        "conversionFactorForAmbulatoryPointsToLargeWheelchairPoints": { "$ref": "#/$defs/integerNullable" },
        "flatFloor": { "$ref": "#/$defs/stringNullable" },
        "owner": { "$ref": "#/$defs/stringNullable" },
        "rideVibrationQuality": { "$ref": "#/$defs/stringNullable" }
      },
      "required": [ "tripTicketId" ]
    },

    "vehicleGeographicLocation": {
      "type": "object",
      "description": "The coordinates for the address and potentially a known zone",
      "properties": {
        "vehicleDistance": { "$ref": "#/$defs/VehicleDistance" },
        "zone": { "$ref": "#/$defs/stringNullable" },
        "typeOfCoordinate": {
          "type": "string",
          "description": "Shall be of type WGS84",
          "enum": [ "WGS84", "WGS-84", "RT90" ],
          "nullable": false
        },
        "lat": { "type": "integer" },
        "long": { "type": "integer" },
        "precision": {
          "type": "integer",
          "description": "Precision shall be from GPS-unit in vehicle and measured in meter. This is the deviation in position measured by the &gt;GPS-unit."
        },
        "speed": {
          "allOf": [
            { "$ref": "#/$defs/floatNullable" },
            {
              "description": "Speed shall be from GPS-unit in vehicle and measured in meter per second."
            }
          ]
        },
        "speedSource": {
          "description": "Speed measured at GPS or VEHICLE.",
          "enum": [ "gpsunit", "taximeter" ]
        },
        "direction": {
          "allOf": [
            { "$ref": "#/$defs/integerNullable" },
            { "description": "Direction shall be from GPS-unit in vehichle and measured in degrees (0 - 360 degrees)" }
          ]
        },
        "height": {
          "allOf": [
            { "$ref": "#/$defs/floatNullable" },
            { "description": "Height shall be from GPS-unit in vehicle and measured in meter. May be measured in meter with decimals." }
          ]
        },
        "deviationSpeed": {
          "allOf": [
            { "$ref": "#/$defs/floatNullable" },
            { "description": "Deviation in speed" }
          ]
        }
      },
      "required": [ "typeOfCoordinate" ]
    },

    "tripTask": {
      "type": "object",
      "description": "Telegram #: 3A; From: trip provider; To: vehicle; Purpose: control vehicle",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "tripTaskId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique ID from provider"
        },
        "customerPickupLocInVehPerformanceSequence": {
          "type": "integer",
          "minimum": 0
        },
        "pickupNodeAddress": { "$ref": "#/$defs/AddressType" },
        "pickupNodeScheduledTime": { "$ref": "#/$defs/Time" },
        "detailedPickupLocationDescription": { "$ref": "#/$defs/stringNullable" },
        "customerDropoffLocInVehPerformanceSequence": {
          "type": "integer",
          "minimum": 0
        },
        "dropoffNodeAddress": { "$ref": "#/$defs/AddressType" },
        "dropoffNodeScheduledTime": { "$ref": "#/$defs/Time" },
        "detailedDropoffLocationDescription": { "$ref": "#/$defs/stringNullable" },
        "customerMobilePhone": { "$ref": "#/$defs/integerNullable" },
        "customerName": { "type": "string" },
        "numOtherReservedPassengers": { "$ref": "#/$defs/integerNullable" },
        "notesForDriver": {
          "allOf": [
            { "$ref": "#/$defs/stringNullable" },
            { "description": "Free-form long text field for notes to driver concerning customer service needs" }
          ]
        },
        "specialAttributes": { "$ref": "#/$defs/SpecialAttributesList" },
        "paymentType": { "$ref": "#/$defs/PaymentTypeList" },
        "fareAmount": { "$ref": "#/$defs/integerNullable" }
      },
      "required": [ "tripTicketId" ]
    },

    "tripTaskConfirmation": {
      "type": "object",
      "description": "Telegram #: 3B; From: vehicle; To: trip provider; Purpose: confirm vehicle performed task",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "tripTaskId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique ID from provider"
        },
        "customerLocInDropoffSequence": {
          "type": "integer",
          "minimum": 0
        },
        "nodePerformedTime": { "$ref": "#/$defs/Time" },
        "vehicleNumber": { "$ref": "#/$defs/stringNullable" },
        "tripStatus": {
          "type": "string",
          "enum": [ "performed", "no show", "no pickup" ]
        },
        "driverId": { "$ref": "#/$defs/stringNullable" }
      },
      "required": [ "tripTicketId", "tripStatus" ]
    },

    "tripTaskCompletion": {
      "type": "object",
      "description": "Telegram #: 4A; From: trip provider(s); To: ordering client; Purpose: performed trip data",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "cost": { "type": "integer" },
        "performedPickupPoint": { "$ref": "#/$defs/AddressType" },
        "performedPickupTime": { "$ref": "#/$defs/Time" },
        "performedDropoffPoint": { "$ref": "#/$defs/AddressType" },
        "performedDropoffTime": { "$ref": "#/$defs/Time" },
        "performedDistance": { "$ref": "#/$defs/integerNullable" },
        "performedDistanceUnit": { "$ref": "#/$defs/DistanceUnitList" },
        "performedDurationInMinutes": { "$ref": "#/$defs/integerNullable" },
        "detourOccur": { "$ref": "#/$defs/booleanNullable" },
        "transferPoint": { "$ref": "#/$defs/AddressType" },
        "paymentType": { "$ref": "#/$defs/PaymentTypeList" },
        "fareAmount": { "$ref": "#/$defs/integerNullable" },
        "specialAttributes": { "$ref": "#/$defs/SpecialAttributesList" },
        "transportServices": { "$ref": "#/$defs/ValueList" }
      },
      "required": [ "tripTicketId" ]
    },

    "customerReferral": {
      "type": "object",
      "description": "Telegram #: 0A; From: ordering client; To: trip provider; Purpose: Send customer information to provider for possible services",
      "properties": {
        "customerReferralId": {
          "type": "string",
          "description": "unique ID from ordering client"
        },
        "customerContactDate": {
          "type": "string",
          "format": "date"
        },
        "note": { "$ref": "#/$defs/stringNullable" },
        "customerInfo": {
          "$ref": "#/$defs/CustomerInfoType"
        }
      },
      "required": [ "customerReferralId", "customerContactDate" ]
    },

    "customerReferralResponse": {
      "type": "object",
      "description": "Telegram #: 1C; Sent from ordering client To: trip provider(s) or ; trip provider to ordering client Purpose: to report trip status change due to being canceled or no longer available",
      "properties": {
        "customerReferralId": {
          "type": "string",
          "description": "unique ID from ordering client"
        },
        "referralResponseType": { "$ref": "#/$defs/stringNullable" },
        "note": {
          "$ref": "#/$defs/stringNullable"
        }
      },
      "required": [ "customerReferralId" ]
    }

  },
  "$defs": {
    "TripTicketIdProperty": {
      "type": "string",
      "format": "uuid",
      "description": "Unique ID from ordering client"
    },

    "CustomerInfoType": {
      "type": "object",
      "properties": {
        "tripTicketId": { "$ref": "#/$defs/TripTicketIdProperty" },
        "firstLegalName": { "$ref": "#/$defs/stringNullable" },
        "nickName": { "$ref": "#/$defs/stringNullable" },
        "middleName": { "$ref": "#/$defs/stringNullable" },
        "lastName": { "$ref": "#/$defs/stringNullable" },
        "address": { "$ref": "#/$defs/AddressType" },
        "phone": { "$ref": "#/$defs/integerNullable" },
        "mobilePhone": { "$ref": "#/$defs/integerNullable" },
        "mailingBillingAddress": { "$ref": "#/$defs/AddressType" },
        "fundingEntityBillingInformation": { "$ref": "#/$defs/stringNullable" },
        "fundingType": { "$ref": "#/$defs/booleanNullable" },
        "fundingEntityId": { "type": "string" },
        "gender": { "$ref": "#/$defs/stringNullable" },
        "lowIncome": { "$ref": "#/$defs/booleanNullable" },
        "disability": { "$ref": "#/$defs/booleanNullable" },
        "language": { "$ref": "#/$defs/stringNullable" },
        "race": { "$ref": "#/$defs/stringNullable" },
        "ethnicity": { "$ref": "#/$defs/booleanNullable" },
        "emailAddress": { "$ref": "#/$defs/stringNullable" },
        "veteran": { "$ref": "#/$defs/stringNullable" },
        "caregiverContactInformation": { "$ref": "#/$defs/stringNullable" },
        "emergencyPhoneNumber": { "$ref": "#/$defs/integerNullable" },
        "emergencyContactName": { "$ref": "#/$defs/stringNullable" },
        "emergencyContactRelationship": { "$ref": "#/$defs/stringNullable" },
        "requiredCareComments": { "$ref": "#/$defs/stringNullable" },
        "dateOfBirth": {
          "allOf": [
            { "$ref": "#/$defs/stringNullable" },
            { "format": "date" }
          ]
        },
        "customerId": { "$ref": "#/$defs/stringNullable" },
        "notesForDriver": { "$ref": "#/$defs/stringNullable" }
      }
    },

    "AddressType": {
      "type": "object",
      "description": "The address known to receiving system",
      "properties": {
        "addressName": {
          "allOf": [
            { "$ref": "#/$defs/stringNotEmpty" },
            { "example": "McDonalds" }
          ]
        },
        "street": { "$ref": "#/$defs/stringNotEmpty" },
        "street2": { "$ref": "#/$defs/stringNullable" },
        "notes": {
          "allOf": [
            { "$ref": "#/$defs/stringNullable" },
            { "example": "Green door around the back" }
          ]
        },
        "city": { "$ref": "#/$defs/stringNotEmpty" },
        "state": { "$ref": "#/$defs/stringNotEmpty" },
        "postalCode": { "$ref": "#/$defs/stringNotEmpty" },
        "country": { "$ref": "#/$defs/stringNotEmpty" },
        "lat": {
          "allOf": [
            { "$ref": "#/$defs/integerNullable" },
            {
              "minimum": -90,
              "maximum": 90
            }
          ]
        },
        "long": {
          "allOf": [
            { "$ref": "#/$defs/integerNullable" },
            {
              "minimum": -180,
              "maximum": 180
            }
          ]
        }
      },
      "required": [ "addressName", "street", "city", "state", "postalCode", "country" ]
    },

    "Time": {
      "type": "object",
      "description": "Should normally be the local time.",
      "properties": {
        "timeAccuracy": {
          "allOf": [
            { "$ref": "#/$defs/stringNullable" },
            { "description": "Used to indicate accepted deviation in attribute time" }
          ]
        },
        "time": {
          "type": "string",
          "format": "date-time",
          "description": "Timezone used in comunication. Default is local timezone. See ISO 8601 for more information."
        },
        "dwellTime": {
          "allOf": [
            { "$ref": "#/$defs/integerNullable" },
            { "description": "Time used to finish this node" }
          ]
        },
        "timeType": { "$ref": "#/$defs/TimeType" }
      },
      "required": [ "time" ]
    },

    "TimeType": {
      "allOf": [
        { "$ref": "#/$defs/stringNullable" },
        { "enum": [ "Time2101", "ScheduledTime", "Time2102", "EstimatedTime", "Time2103", "PromisedTime", "Time2104", "Actual", "Time2105", "Scheduled", "Time2107", "Estimated", "Time2106", "Promised", "Time2108", "Asap", "EstimatedEndTime", "EstimatedStartTime" ] }
      ]
    },

    "DistanceUnitList": {
      "type": "string",
      "enum": [ "Miles", "Kilometers" ]
    },

    "PaymentTypeList": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [ "cash", "card", "account", "ticket", "noShow", "providerCompensation" ]
      }
    },

    "SpecialAttributesList": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [ "A", "AL", "C", "CU", "D2D", "DA", "DTD", "E", "HI", "IDD", "MI", "NLA", "O", "S", "SA", "SD", "SI", "TD", "U", "VI", "W", "WA", "WAK", "WE", "WT", "WW" ],
        "description": "- A:- Mobility Aid: Ambulatory - AL:- Mobility Aid: Ambulatory lift - C:- Mobility Aid: Cane - CU:- Mobility Aid: Crutches - D2D:- Service Needs: Door to door - DA:- Service Needs: Driver Alert - DTD:- Service Needs: Door THROUGH door - E:- Mobility Aid: Electric wheelchair - HI:- Service Needs: hearing impaired - IDD:- Medical: Intellectually or developmentally disabled - MI:- Medical: Dementia (memory impaired) - NLA:- Service Needs: Never leave alone/ no leave alone - O:- Service Needs: Oxygen - S:- Mobility Aid: Scooter - SA:- Service Needs: Service Animal - SD:- Service Needs: Seizure disorder - SI:- Medical: Speech impaired - TD:- Medical: Temporary Disability - U:- Service Needs: Unstable needs assistance - VI:- Medical: Vision impaired - W:- Mobility Aid: Wheelchair - WA:- Mobility Aid: Walker - WAK:- Mobility Aid: Knee walker - WE:- Mobility Aid: Extended leg w/c = Extended Leg Wheelchair - WT:- Mobility Aid: Transport Chair, Must Transfer - WW:- Mobility Aid: Wide wheelchair"
      }
    },

    "TripPurposeList": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [ "A", "D", "E", "ED", "G", "HR", "M", "MS", "P", "R", "T" ],
        "description": "- A:- Adult Day Program - D:- Dialysis - E:- Employment - ED:- Educational - G:- Grocery - HR:- Health-Related (includes dentist, pharmacy, etc.) - M:- Medical - MS:- Miscellaneous - P:- Personal - R:- Recreation - T:- Public transit"
      }
    },

    "ValueList": {
      "type": "array",
      "items": { "type": "string" }
    },

    "VehicleDistance": {
      "type": "object",
      "properties": {
        "startTime": {
          "allOf": [
            { "$ref": "#/$defs/Time" },
            {
              "description": "The time period to propose car starts"
            }
          ]
        },
        "stopTime": {
          "allOf": [
            {
              "$ref": "#/$defs/Time"
            },
            {
              "description": "The time period to propose car stops"
            }
          ]
        },
        "range": {
          "type": "integer",
          "description": "The distance within which an unoccupied vehicle shall be proposed"
        },
        "rangeUnit": {
          "type": "string",
          "enum": [ "meter", "seconds" ]
        }
      }
    },

    "stringNullable": { "type": [ "string", "null" ] },

    "booleanNullable": { "type": [ "boolean", "null" ] },

    "integerNullable": { "type": [ "integer", "null" ] },

    "floatNullable": {
      "type": [ "number", "null" ],
      "format": "float"
    },

    "stringNotEmpty": {
      "type": [ "string" ],
      "minLength": 1
    }
  }
}
